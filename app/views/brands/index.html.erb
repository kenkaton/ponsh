<% content_for :title, t('brands.index.title') %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="font-bold text-4xl"><%= t('brands.index.title') %></h1>
  </div>

  <div class="mb-8">
    <%= render partial: 'shared/search_form', locals: { visible: '', query: @query } %>
  </div>

  <div id="brands" class="space-y-4">
    <% if @brands.any? %>
      <% @brands.each do |brand| %>
        <%= link_to brand, class: "block w-full", data: { action: "click->gtm#track", "gtm-event-value" => "view_brand_from_list", "gtm-category-value" => "brand", "gtm-action-value" => "view_brand_from_list", "gtm-label-value" => brand.name } do %>
          <div id="<%= dom_id brand %>" class="w-full flex gap-4 items-center p-4 border rounded-lg shadow-sm hover:bg-gray-50">
            <!-- 商品画像 -->
            <div class="flex-shrink-0">
              <% if brand.primary_image.present? %>
                <%= image_tag brand.primary_image,
                    alt: brand.name,
                    class: "w-16 h-16 object-contain rounded",
                    loading: "lazy" %>
              <% else %>
                <!-- 画像がない場合のプレースホルダー -->
                <div class="w-16 h-16 bg-gray-100 rounded flex items-center justify-center">
                  <svg class="w-8 h-8 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M9 2h6v5.5c1.5.5 2.5 2 2.5 3.5v9c0 1.1-.9 2-2 2h-7c-1.1 0-2-.9-2-2v-9c0-1.5 1-3 2.5-3.5V2zm2 2v3.3c-.3-.1-.6-.2-1-.2s-.7.1-1 .2V4h2zm3 0v3.3c.3.1.6.2 1 .2V4h-1zm-5 6c-1.1 0-2 .9-2 2v8h10v-8c0-1.1-.9-2-2-2H9z"/>
                  </svg>
                </div>
              <% end %>
            </div>

            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-2">
                <h3 class="text-lg font-medium text-gray-900"><%= brand.name %></h3>
                <span class="text-sm text-gray-500"><%= brand.kana %></span>

                <!-- EC listing状態表示 -->
                <% if brand.ec_listings.loaded? %>
                  <% ec_count = brand.ec_listings.select(&:is_available).size %>
                  <% if ec_count > 0 %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                      EC: <%= ec_count %>件
                    </span>
                  <% end %>
                <% end %>
              </div>
              <% if brand.company.present? %>
                <div class="mt-1 text-sm text-gray-600">
                  <%= brand.company.name %>
                  <% if brand.company.address.present? %>
                    <span class="text-gray-400">/</span>
                    <%= brand.company.address.prefecture.name %>
                    <span class="text-gray-400">/</span>
                    <%= brand.company.address.city %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <p class="text-center my-10"><%= t('brands.index.no_brands') %></p>
    <% end %>
  </div>

  <div class="mt-8 flex justify-center">
    <%== pagy_nav(@pagy, class: 'pagy') %>
  </div>
</div>
