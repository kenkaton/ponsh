<% content_for :title, t('brands.index.title') %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="font-bold text-4xl"><%= t('brands.index.title') %></h1>
  </div>

  <div class="mb-8">
    <%= render partial: 'shared/search_form', locals: { visible: '', query: @query } %>
  </div>

  <div id="brands" class="space-y-4">
    <% if @brands.any? %>
      <% @brands.each do |brand| %>
        <%= link_to brand, class: "block w-full", data: { action: "click->gtm#track", "gtm-event-value" => "view_brand_from_list", "gtm-category-value" => "brand", "gtm-action-value" => "view_brand_from_list", "gtm-label-value" => brand.name } do %>
          <div id="<%= dom_id brand %>" class="w-full flex gap-4 items-center p-4 border rounded-lg shadow-sm hover:bg-gray-50">
            <!-- 商品画像 -->
            <div class="flex-shrink-0">
              <% if brand.primary_image.present? %>
                <%= image_tag brand.primary_image,
                    alt: brand.name,
                    class: "w-16 h-16 object-contain rounded",
                    loading: "lazy" %>
              <% else %>
                <!-- 画像がない場合のプレースホルダー -->
                <div class="w-16 h-16 bg-gray-100 rounded flex items-center justify-center">
                  <svg class="w-8 h-8 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                    <!-- 徳利とお猪口 -->
                    <!-- 徳利 -->
                    <path d="M10 2h4v2.5c0 .3-.1.5-.3.7l-1 1c-.2.2-.3.5-.3.8v1c1.1.4 2 1.5 2 2.8v5.2c0 2.2-.8 4-2.4 4h-3c-1.6 0-2.4-1.8-2.4-4v-5.2c0-1.3.9-2.4 2-2.8V7c0-.3-.1-.6-.3-.8l-1-1c-.2-.2-.3-.4-.3-.7V2zm1 1v1.2l.7.7c.5.5.8 1.2.8 1.9v.5c-.2 0-.3-.1-.5-.1h-1c-.2 0-.3.1-.5.1v-.5c0-.7.3-1.4.8-1.9l.7-.7V3zm-2 7h4c.6 0 1 .4 1 1v5c0 1.7-.4 3-1.4 3h-3.2c-1 0-1.4-1.3-1.4-3v-5c0-.6.4-1 1-1z"/>
                    <!-- お猪口 -->
                    <path d="M16.5 16h4c.3 0 .5.2.5.5v1c0 .3-.1.6-.2.8l-.5 1.2c-.2.3-.5.5-.8.5h-2c-.3 0-.6-.2-.8-.5l-.5-1.2c-.1-.2-.2-.5-.2-.8v-1c0-.3.2-.5.5-.5zm.5 1v1l.4.9c.1.1.2.2.3.2h2c.1 0 .2-.1.3-.2l.4-.9v-1h-3.4z"/>
                  </svg>
                </div>
              <% end %>
            </div>

            <div class="flex-1">
              <div class="flex flex-wrap items-center gap-2">
                <h3 class="text-lg font-medium text-gray-900"><%= brand.name %></h3>
                <span class="text-sm text-gray-500"><%= brand.kana %></span>

                <!-- EC listing状態表示 -->
                <% if brand.ec_listings.loaded? %>
                  <% ec_count = brand.ec_listings.select(&:is_available).size %>
                  <% if ec_count > 0 %>
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                      EC: <%= ec_count %>件
                    </span>
                  <% end %>
                <% end %>
              </div>
              <% if brand.company.present? %>
                <div class="mt-1 text-sm text-gray-600">
                  <%= brand.company.name %>
                  <% if brand.company.address.present? %>
                    <span class="text-gray-400">/</span>
                    <%= brand.company.address.prefecture.name %>
                    <span class="text-gray-400">/</span>
                    <%= brand.company.address.city %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <p class="text-center my-10"><%= t('brands.index.no_brands') %></p>
    <% end %>
  </div>

  <div class="mt-8 flex justify-center">
    <%== pagy_nav(@pagy, class: 'pagy') %>
  </div>
</div>
